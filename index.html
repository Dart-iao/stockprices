<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dart App</title>
    <link rel="apple-touch-icon" sizes="180x180" href="https://dart-iao.github.io/stockprices/darticon.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://dart-iao.github.io/stockprices/darticon.png">
    <link rel="apple-touch-icon" sizes="167x167" href="https://dart-iao.github.io/stockprices/darticon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="https://dart-iao.github.io/stockprices/darticon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://dart-iao.github.io/stockprices/darticon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://dart-iao.github.io/stockprices/darticon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Dart App">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        // Icon components
        const TrendingUp = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>);
        const Star = ({ fill }) => (<svg width="24" height="24" viewBox="0 0 24 24" fill={fill ? "currentColor" : "none"} stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>);
        const ThumbsUp = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>);
        const Activity = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>);
        const DollarSign = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>);
        const Home = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>);
        const Coffee = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>);
        const MessageSquare = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>);
        const Clock = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>);
        const Lightbulb = () => (<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="3" x2="12" y2="1"></line><line x1="18" y1="6" x2="19.5" y2="4.5"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="18" y1="18" x2="19.5" y2="19.5"></line><line x1="6" y1="18" x2="4.5" y2="19.5"></line><line x1="3" y1="12" x2="1" y2="12"></line><line x1="6" y1="6" x2="4.5" y2="4.5"></line><path d="M9 21h6"></path><path d="M9 18h6"></path><circle cx="12" cy="12" r="5"></circle></svg>);

        function DartApp() {
            const [currentPage, setCurrentPage] = useState('main');
            const [selectedStock, setSelectedStock] = useState(null);
            const [feedback, setFeedback] = useState('');
            const [email, setEmail] = useState('');
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');
            const [lastUpdated, setLastUpdated] = useState('');
            const [predictions, setPredictions] = useState([]);
            const [predictionHistory, setPredictionHistory] = useState([]);
            const [showAllPredictions, setShowAllPredictions] = useState(false);
            const [showFeedbackForm, setShowFeedbackForm] = useState(false);

            // Fetch predictions
            useEffect(() => {
               fetch('https://adrianhutchins.pythonanywhere.com/static/predictions.json')
                    .then(res => res.json())
                    .then(data => {
                        setPredictions(data.predictions || []);
                        setLastUpdated(data.generatedTime || new Date().toLocaleString());
                        setLoading(false);
                    })
                    .catch((err) => {
                        console.error('Error fetching predictions:', err);
                        setPredictions([]);
                        setLoading(false);
                    });
            }, []);

            // Fetch prediction history
            useEffect(() => {
                fetch('https://adrianhutchins.pythonanywhere.com/static/prediction_history.json')
                    .then(res => res.json())
                    .then(data => {
                        setPredictionHistory(data.history || []);
                    })
                    .catch((err) => {
                        console.error('Error fetching prediction history:', err);
                        setPredictionHistory([]);
                    });
            }, []);

            const isValidEmail = (e) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);
            const isFormValid = feedback.trim() && email.trim() && isValidEmail(email);
            
            // Enhanced color coding for key factors based on numerical values
            const getFactorColor = (factor) => {
                const lowerFactor = factor.toLowerCase();
                
                // Check for Gap percentage
                if (lowerFactor.includes('gap:')) {
                    const gapMatch = lowerFactor.match(/gap:\s*([\d.]+)/);
                    if (gapMatch) {
                        const gapValue = parseFloat(gapMatch[1]);
                        if (gapValue > 15) return 'bg-green-100 text-green-800'; // Very strong gap
                        if (gapValue > 8) return 'bg-green-50 text-green-700'; // Strong gap
                        if (gapValue > 5) return 'bg-yellow-100 text-yellow-800'; // Moderate gap
                        if (gapValue < 2) return 'bg-red-100 text-red-800'; // Weak gap
                        return 'bg-gray-100 text-gray-800';
                    }
                }
                
                // Check for Volume ratio
                if (lowerFactor.includes('volume:')) {
                    const volMatch = lowerFactor.match(/volume:\s*([\d.]+)/);
                    if (volMatch) {
                        const volValue = parseFloat(volMatch[1]);
                        if (volValue > 5) return 'bg-green-100 text-green-800'; // Extreme volume
                        if (volValue > 3) return 'bg-green-50 text-green-700'; // High volume
                        if (volValue > 2) return 'bg-yellow-100 text-yellow-800'; // Elevated volume
                        if (volValue < 1.5) return 'bg-red-100 text-red-800'; // Low volume (concerning)
                        return 'bg-gray-100 text-gray-800';
                    }
                }
                
                // Check for Float
                if (lowerFactor.includes('float:')) {
                    const floatMatch = lowerFactor.match(/float:\s*([\d.]+)/);
                    if (floatMatch) {
                        const floatValue = parseFloat(floatMatch[1]);
                        if (floatValue < 10) return 'bg-green-100 text-green-800'; // Ultra low float (good for squeeze)
                        if (floatValue < 30) return 'bg-green-50 text-green-700'; // Low float
                        if (floatValue < 50) return 'bg-yellow-100 text-yellow-800'; // Medium float
                        if (floatValue > 100) return 'bg-red-100 text-red-800'; // High float (harder to move)
                        return 'bg-gray-100 text-gray-800';
                    }
                }
                
                // Check for Short Interest
                if (lowerFactor.includes('short:')) {
                    const shortMatch = lowerFactor.match(/short:\s*([\d.]+)/);
                    if (shortMatch) {
                        const shortValue = parseFloat(shortMatch[1]);
                        if (shortValue > 30) return 'bg-orange-100 text-orange-800'; // Very high (squeeze risk/opportunity)
                        if (shortValue > 20) return 'bg-yellow-100 text-yellow-800'; // High short interest
                        if (shortValue > 15) return 'bg-yellow-50 text-yellow-700'; // Elevated
                        return 'bg-gray-100 text-gray-800';
                    }
                }
                
                // Check for News count
                if (lowerFactor.includes('news:')) {
                    const newsMatch = lowerFactor.match(/news:\s*(\d+)/);
                    if (newsMatch) {
                        const newsCount = parseInt(newsMatch[1]);
                        if (newsCount >= 5) return 'bg-green-100 text-green-800'; // Heavy news coverage
                        if (newsCount >= 3) return 'bg-green-50 text-green-700'; // Good news coverage
                        if (newsCount >= 1) return 'bg-yellow-100 text-yellow-800'; // Some news
                        if (newsCount === 0) return 'bg-red-100 text-red-800'; // No news catalyst
                        return 'bg-gray-100 text-gray-800';
                    }
                }
                
                // Text-based patterns from reasoning strings
                if (lowerFactor.includes('strong') && lowerFactor.includes('gap')) {
                    return 'bg-green-100 text-green-800';
                }
                if (lowerFactor.includes('solid') && lowerFactor.includes('gap')) {
                    return 'bg-green-50 text-green-700';
                }
                if (lowerFactor.includes('volume spike')) {
                    return 'bg-green-100 text-green-800';
                }
                if (lowerFactor.includes('elevated volume')) {
                    return 'bg-yellow-100 text-yellow-800';
                }
                if (lowerFactor.includes('fresh news')) {
                    return 'bg-green-100 text-green-800';
                }
                if (lowerFactor.includes('low float')) {
                    return 'bg-green-50 text-green-700';
                }
                if (lowerFactor.includes('high short interest')) {
                    return 'bg-orange-100 text-orange-800';
                }
                if (lowerFactor.includes('trending')) {
                    return 'bg-purple-100 text-purple-800';
                }
                if (lowerFactor.includes('technical setup')) {
                    return 'bg-gray-100 text-gray-800'; // Neutral
                }
                
                // Original keyword-based logic as fallback
                const goodKeywords = ['oversold', 'bullish', 'breakthrough', 'upgrade', 'approval', 'deal', 'partnership', 'breakout', 'catalyst', 'momentum'];
                if (goodKeywords.some(keyword => lowerFactor.includes(keyword))) {
                    return 'bg-green-100 text-green-800';
                }
                
                const badKeywords = ['overbought', 'bearish', 'downgrade', 'concern', 'warning', 'loss', 'decline', 'weak', 'resistance', 'rejected'];
                if (badKeywords.some(keyword => lowerFactor.includes(keyword))) {
                    return 'bg-red-100 text-red-800';
                }
                
                const cautionKeywords = ['volatile', 'risky', 'uncertain'];
                if (cautionKeywords.some(keyword => lowerFactor.includes(keyword))) {
                    return 'bg-yellow-100 text-yellow-800';
                }
                
                // Default to neutral gray
                return 'bg-gray-100 text-gray-800';
            };
            
            // Main Page
            if (currentPage === 'main') return (
                <div className="min-h-screen bg-white p-4 pb-24" style={{paddingTop: 'calc(1rem + env(safe-area-inset-top))'}}>
                    <div className="max-w-6xl mx-auto mb-6">
                        <div className="flex items-center justify-end mb-2">
                        </div>
                        {lastUpdated && <p className="text-xs text-gray-500 mt-1">Last updated: {lastUpdated}</p>}
                        {error && <div className="mt-4 bg-red-50 border border-red-200 rounded-lg p-3 text-sm text-red-600">{error}</div>}
                    </div>
                    
                     <div className="max-w-6xl mx-auto mb-8 bg-gray-100 rounded-lg p-4 border">
                        <div className="mb-4">
                            <h2 className="text-xl font-bold flex items-center gap-2">
                                <div className="text-pink-500"><ThumbsUp /></div>
                                Likely to move today
                            </h2>
                            <div className="text-xs text-gray-500 mt-1 text-right">Confidence Score</div>
                        </div>
                        {loading ? (
                            <div className="text-center py-12"><Activity /><p className="text-gray-600">Loading...</p></div>
                        ) : predictions.length === 0 ? (
                            <div className="text-center py-12"><p className="text-gray-600">Generating predictions... Check back soon!</p></div>
                        ) : (
                            <div className="space-y-2">
                                {predictions.map(pred => (
                                    <div key={pred.ticker} onClick={() => { setSelectedStock({...pred, isPrediction: true}); setCurrentPage('detail'); }} className="bg-white rounded-lg p-3 border hover:border-purple-500 cursor-pointer">
                                        <div className="flex justify-between mb-2">
                                            <div className="flex gap-2">
                                                <span className="font-bold">{pred.ticker}</span>
                                                <span className="text-xs text-gray-600">{pred.name}</span>
                                            </div>
                                            <div className="bg-purple-200 text-purple-800 px-2 py-0.5 rounded-full text-xs">{pred.confidence}%</div>
                                        </div>
                                        <div className="text-xs"><span className="text-gray-600">Predicted: </span><span className="text-purple-600 font-bold">{pred.predictedMove}</span></div>
                                        <div className="flex flex-wrap gap-1 mt-2">
                                            {pred.keyFactors.map((factor, idx) => (
                                                <span key={idx} className={`px-2 py-0.5 rounded text-xs ${getFactorColor(factor)}`}>{factor}</span>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    
                    <div className="max-w-6xl mx-auto mt-6 px-4">
                        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <p className="text-xs text-gray-700 text-center mb-2">
                                <strong>DISCLAIMER:</strong> This app is for informational and entertainment purposes only. 
                                Nothing on this site constitutes financial, investment, legal, or tax advice. 
                                Stock predictions are based on automated analysis and may be inaccurate. 
                                Past performance does not guarantee future results. Trading stocks involves risk, 
                                including loss of principal. Always do your own research and consult a licensed 
                                financial advisor before making investment decisions. We are not registered investment advisors.
                            </p>
                            <p className="text-xs text-gray-500 text-center">
                                Data sources: Yahoo Finance, NewsAPI, Alpha Vantage, Finviz
                            </p>
                        </div>
                    </div>
                    
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg" style={{paddingBottom: 'env(safe-area-inset-bottom)'}}>
                        <div className="flex justify-around max-w-lg mx-auto px-4 py-4">
                            <button onClick={() => setCurrentPage('main')} className="flex flex-col items-center gap-1 text-pink-500" style={{marginTop: '-2px'}}><Home /><span className="text-xs">Home</span></button>
                            <button onClick={() => setCurrentPage('predictions')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Clock /><span className="text-xs">Predictions</span></button>
                            <button onClick={() => setCurrentPage('insights')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Lightbulb /><span className="text-xs">Insights</span></button>
                            <button onClick={() => setCurrentPage('coffee')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Coffee /><span className="text-xs">Coffee</span></button>
                        </div>
                    </div>
                </div>
            );
            
            // Predictions History Page - keeping full original code
            if (currentPage === 'predictions') {
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                const twoWeeksAgoStr = twoWeeksAgo.toISOString().split('T')[0];
                
                const recentPredictions = predictionHistory
                    .filter(pred => pred.predictionDate >= twoWeeksAgoStr)
                    .sort((a, b) => new Date(b.predictionDate) - new Date(a.predictionDate));
                
                const uniqueDates = [...new Set(recentPredictions.map(pred => pred.predictionDate))].sort().reverse();
                
                const mostRecentDate = uniqueDates[0];
                const secondMostRecentDate = uniqueDates[1];
                
                const mostRecentPredictions = recentPredictions.filter(pred => pred.predictionDate === mostRecentDate);
                const mostRecentCorrect = mostRecentPredictions.filter(pred => pred.wasCorrect).length;
                const mostRecentTotal = mostRecentPredictions.length;
                const mostRecentAccuracy = mostRecentTotal > 0 ? ((mostRecentCorrect / mostRecentTotal) * 100).toFixed(0) : 0;
                
                const accuracyPercentage = mostRecentAccuracy;
                
                const correctPredictions = recentPredictions.filter(pred => pred.wasCorrect).length;
                const totalPredictions = recentPredictions.length;
                
                const secondMostRecentPredictions = recentPredictions.filter(pred => pred.predictionDate === secondMostRecentDate);
                const secondMostRecentCorrect = secondMostRecentPredictions.filter(pred => pred.wasCorrect).length;
                const secondMostRecentTotal = secondMostRecentPredictions.length;
                const secondMostRecentAccuracy = secondMostRecentTotal > 0 ? ((secondMostRecentCorrect / secondMostRecentTotal) * 100).toFixed(0) : null;
                
                const accuracyChange = (mostRecentAccuracy !== null && secondMostRecentAccuracy !== null) ? (parseFloat(mostRecentAccuracy) - parseFloat(secondMostRecentAccuracy)).toFixed(0) : null;
                
                const formatDate = (dateStr) => {
                    const [year, month, day] = dateStr.split('-').map(Number);
                    const date = new Date(year, month - 1, day);
                    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                                    'July', 'August', 'September', 'October', 'November', 'December'];
                    return `${days[date.getDay()]}. - ${months[date.getMonth()]} ${date.getDate()}`;
                };
                
                return (
                    <div className="min-h-screen bg-white p-4 pb-24" style={{paddingTop: 'calc(1rem + env(safe-area-inset-top))'}}>
                        <div className="max-w-6xl mx-auto mb-6">
                            <h1 className="text-3xl font-bold mb-2">Prediction History</h1>
                        </div>
                        
                        <div className="max-w-6xl mx-auto bg-gray-100 rounded-lg p-4 border">
                            
                            {totalPredictions > 0 && (
                                <div className="mb-6">
                                    <div className="bg-white rounded-xl p-4 border mb-4 text-center">
                                        <div className="text-5xl md:text-6xl font-bold text-pink-600 mb-2">{accuracyPercentage}%</div>
                                        <div className="text-sm md:text-lg text-gray-600">Predicted correctly yesterday</div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                        {/* LEFT CONTAINER: Accuracy Percentages */}
                                        <div className="bg-white rounded-lg p-3 border">
                                            <h3 className="text-xs font-semibold text-gray-700 mb-2 text-center">Accuracy</h3>
                                            
                                            {/* Two smaller containers inline */}
                                            <div className="grid grid-cols-2 gap-2">
                                                {/* Yesterday's Accuracy */}
                                                <div className="bg-white rounded-lg p-2 border text-center">
                                                    <div className="text-xs text-gray-600 mb-1">Yesterday</div>
                                                    <div className="text-xl font-bold text-gray-700">{accuracyPercentage}%</div>
                                                    <div className="text-xs text-gray-500 mt-1">{mostRecentCorrect}/{mostRecentTotal}</div>
                                                </div>

                                                {/* 90-Day Accuracy */}
                                                <div className="bg-white rounded-lg p-2 border text-center">
                                                    <div className="text-xs text-gray-600 mb-1">90 Days</div>
                                                    <div className="text-xl font-bold text-gray-700">
                                                        {(() => {
                                                            const ninetyDayCorrect = predictionHistory.filter(p => p.wasCorrect).length;
                                                            const ninetyDayTotal = predictionHistory.length;
                                                            return ninetyDayTotal > 0 ? ((ninetyDayCorrect / ninetyDayTotal) * 100).toFixed(0) : 0;
                                                        })()}%
                                                    </div>
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        {predictionHistory.filter(p => p.wasCorrect).length}/{predictionHistory.length}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* RIGHT CONTAINER: Total Counts */}
                                        <div className="bg-white rounded-lg p-3 border">
                                            <h3 className="text-xs font-semibold text-gray-700 mb-2 text-center">Predicted Correctly</h3>
                                            
                                            {/* Two smaller containers inline */}
                                            <div className="grid grid-cols-2 gap-2">
                                                {/* Last 2 Weeks */}
                                                <div className="bg-white rounded-lg p-2 border text-center">
                                                    <div className="text-xs text-gray-600 mb-1">2 Weeks</div>
                                                    <div className="text-xl font-bold text-gray-700">{correctPredictions}/{totalPredictions}</div>
                                                    <div className="text-xs text-gray-500 mt-1">correct</div>
                                                </div>

                                                {/* Last 90 Days */}
                                                <div className="bg-white rounded-lg p-2 border text-center">
                                                    <div className="text-xs text-gray-600 mb-1">90 Days</div>
                                                    <div className="text-xl font-bold text-gray-700">
                                                        {predictionHistory.filter(p => p.wasCorrect).length}/{predictionHistory.length}
                                                    </div>
                                                    <div className="text-xs text-gray-500 mt-1">correct</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="text-xs text-gray-500 italic text-center">
                                        Wrong/Right is based on highest price from 4am-10am. History below shows only 2 weeks worth of stocks. Behind the scenes it holds 90 days worth for the learning module.
                                    </div>
                                </div>
                            )}
                            
                            {recentPredictions.length === 0 ? (
                            <div className="text-center py-20">
                                <div className="w-20 h-20 mx-auto mb-4 text-gray-300"><Clock /></div>
                                <p className="text-gray-600 text-lg">No prediction history yet</p>
                                <p className="text-gray-500 text-sm mt-2">Check back after predictions are made and verified</p>
                            </div>
                        ) : (
                            <>
                            <div className="space-y-2">
                                {recentPredictions.slice(0, showAllPredictions ? recentPredictions.length : 20).map((pred, idx) => {
                                    const actualMove = pred.actualMove || '0%';
                                    const movePercent = parseFloat(actualMove.replace('%', '').replace('+', ''));
                                    const noMovement = movePercent === 0;
                                    
                                    let borderColor = 'border-red-500';
                                    let badgeColor = 'bg-red-100 text-red-800';
                                    let badgeText = '✗ WRONG';
                                    
                                    if (noMovement) {
                                        borderColor = 'border-gray-300';
                                        badgeColor = 'bg-gray-100 text-gray-600';
                                        badgeText = '— NO MOVE';
                                    } else if (pred.wasCorrect) {
                                        borderColor = 'border-green-500';
                                        badgeColor = 'bg-green-100 text-green-800';
                                        badgeText = '✓ CORRECT';
                                    }
                                    
                                    return (
                                    <div key={idx} className={`bg-white rounded-lg p-4 border-l-4 ${borderColor}`}>
                                        <div className="flex justify-between items-start">
                                            <div className="flex-1">
                                                <div className="flex items-center gap-2 mb-1">
                                                    <h3 className="text-lg font-bold text-gray-800">{pred.ticker}</h3>
                                                    <span className="text-xs text-gray-500">{pred.name}</span>
                                                </div>
                                                <p className="text-xs text-gray-600 leading-tight mb-1">
                                                    Predicted: <span className={`font-semibold ${pred.predictedMove && pred.predictedMove.startsWith('+') ? 'text-green-600' : pred.predictedMove && pred.predictedMove.startsWith('-') ? 'text-red-600' : 'text-gray-700'}`}>
                                                        {pred.predictedMove || 'N/A'}
                                                    </span>
                                                </p>
                                                <p className="text-xs text-gray-600 leading-tight mb-1">
                                                    Start: <span className="font-semibold">${pred.predictedPrice !== undefined ? pred.predictedPrice.toFixed(2) : '0.00'}</span>
                                                </p>
                                                <p className="text-xs text-gray-500 leading-tight mb-1">
                                                    {formatDate(pred.predictionDate)}
                                                </p>
                                                <p className="text-xs text-gray-500 leading-tight mb-2">
                                                    Confidence: {pred.confidence !== undefined ? pred.confidence : '0'}%
                                                </p>
                                                
                                                {pred.keyFactors && pred.keyFactors.length > 0 && (
                                                    <div className="flex flex-wrap gap-1 mt-2">
                                                        {pred.keyFactors.map((factor, factorIdx) => (
                                                            <span key={factorIdx} className={`px-2 py-0.5 rounded text-xs ${getFactorColor(factor)}`}>
                                                                {factor}
                                                            </span>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div className="text-right">
                                                <span className={`px-2 py-1 rounded-full text-xs font-semibold inline-block mb-1 ${badgeColor}`}>
                                                    {badgeText}
                                                </span>
                                                <p className="text-xs text-gray-600 leading-tight mb-1">
                                                    Actual: <span className={`font-semibold ${pred.actualMove && pred.actualMove.startsWith('+') ? 'text-green-600' : pred.actualMove && pred.actualMove.startsWith('-') ? 'text-red-600' : 'text-gray-700'}`}>
                                                        {pred.actualMove || 'N/A'}
                                                    </span>
                                                </p>
                                                <p className="text-xs text-gray-600 leading-tight mb-1">
                                                    End: <span className="font-semibold">${pred.actualPrice !== undefined ? pred.actualPrice.toFixed(2) : '0.00'}</span>
                                                </p>
                                                <p className="text-xs text-gray-700 whitespace-nowrap leading-tight">
                                                    $50 → <span className={`font-bold ${((pred.actualPrice || 0) >= (pred.predictedPrice || 0)) ? 'text-green-600' : 'text-red-600'}`}>${(50 * ((pred.actualPrice || 0) / (pred.predictedPrice || 1))).toFixed(2)}</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    );
                                })}
                            </div>
                            {recentPredictions.length > 20 && (
                                <div className="text-center mt-4">
                                    <button 
                                        onClick={() => setShowAllPredictions(!showAllPredictions)}
                                        className="px-6 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 font-medium"
                                    >
                                        {showAllPredictions ? 'Show Less' : `Show ${recentPredictions.length - 20} More`}
                                    </button>
                                </div>
                            )}
                            
                            {recentPredictions.length > 0 && (
                                <div className="mt-6">
                                    {(() => {
                                        const displayedPredictions = showAllPredictions ? recentPredictions : recentPredictions.slice(0, 20);
                                        const totalProfit = displayedPredictions.reduce((sum, pred) => {
                                            const startPrice = pred.predictedPrice || 0;
                                            const endPrice = pred.actualPrice || 0;
                                            const finalValue = startPrice > 0 ? 50 * (endPrice / startPrice) : 50;
                                            return sum + (finalValue - 50);
                                        }, 0);
                                        
                                        const profitColor = totalProfit >= 0 ? 'text-green-600' : 'text-red-600';
                                        const bgColor = totalProfit >= 0 ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
                                        
                                        return (
                                            <div className={`rounded-lg p-4 border ${bgColor} text-center`}>
                                                <p className="text-sm text-gray-700">
                                                    Overall simulated investment summary: <span className={`font-bold text-lg ${profitColor}`}>{totalProfit >= 0 ? '+' : ''}${totalProfit.toFixed(2)}</span>
                                                </p>
                                            </div>
                                        );
                                    })()}
                                </div>
                            )}
                            </>
                        )}
                    </div>
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg" style={{paddingBottom: 'env(safe-area-inset-bottom)'}}>
                        <div className="flex justify-around max-w-lg mx-auto px-4 py-4">
                            <button onClick={() => setCurrentPage('main')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Home /><span className="text-xs">Home</span></button>
                            <button onClick={() => setCurrentPage('predictions')} className="flex flex-col items-center gap-1 text-pink-500" style={{marginTop: '-2px'}}><Clock /><span className="text-xs">Predictions</span></button>
                            <button onClick={() => setCurrentPage('insights')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Lightbulb /><span className="text-xs">Insights</span></button>
                            <button onClick={() => setCurrentPage('coffee')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Coffee /><span className="text-xs">Coffee</span></button>
                        </div>
                    </div>
                </div>
            );
            }
            
            // Insights Page (keeping as is)
            if (currentPage === 'insights') {
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                const twoWeeksAgoStr = twoWeeksAgo.toISOString().split('T')[0];
                
                const recentHistory = predictionHistory
                    .filter(pred => pred.predictionDate >= twoWeeksAgoStr)
                    .sort((a, b) => new Date(b.predictionDate) - new Date(a.predictionDate));
                
                const predictionsWithProfit = recentHistory.map(pred => {
                    const startPrice = pred.predictedPrice || 0;
                    const endPrice = pred.actualPrice || 0;
                    const profit = startPrice > 0 ? 50 * (endPrice / startPrice) - 50 : 0;
                    return { ...pred, profit };
                });
                
                const topWins = [...predictionsWithProfit]
                    .filter(p => p.profit > 0)
                    .sort((a, b) => b.profit - a.profit)
                    .slice(0, 5);
                
                const topLosses = [...predictionsWithProfit]
                    .filter(p => p.profit < 0)
                    .sort((a, b) => a.profit - b.profit)
                    .slice(0, 5);
                
                const dayStats = {};
                const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                
                recentHistory.forEach(pred => {
                    const date = new Date(pred.predictionDate);
                    const dayName = dayNames[date.getDay()];
                    if (!dayStats[dayName]) {
                        dayStats[dayName] = { correct: 0, total: 0 };
                    }
                    dayStats[dayName].total++;
                    if (pred.wasCorrect) dayStats[dayName].correct++;
                });
                
                const weeklyStats = [];
                for (let i = 3; i >= 0; i--) {
                    const weekStart = new Date();
                    weekStart.setDate(weekStart.getDate() - (i * 7) - 7);
                    const weekEnd = new Date();
                    weekEnd.setDate(weekEnd.getDate() - (i * 7));
                    
                    const weekPreds = recentHistory.filter(pred => {
                        const predDate = new Date(pred.predictionDate);
                        return predDate >= weekStart && predDate < weekEnd;
                    });
                    
                    const correct = weekPreds.filter(p => p.wasCorrect).length;
                    const total = weekPreds.length;
                    const accuracy = total > 0 ? ((correct / total) * 100).toFixed(0) : 0;
                    
                    weeklyStats.push({
                        label: `Week ${4-i}`,
                        accuracy: accuracy,
                        total: total
                    });
                }
                
                const formatDate = (dateStr) => {
                    const date = new Date(dateStr);
                    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    return `${months[date.getMonth()]} ${date.getDate()}`;
                };
                
                return (
                <div className="min-h-screen bg-white p-4 pb-24" style={{paddingTop: 'calc(1rem + env(safe-area-inset-top))'}}>
                    <div className="max-w-6xl mx-auto">
                        <h1 className="text-3xl font-bold mb-2">Insights</h1>
                        <p className="text-sm text-gray-600 mb-6">Performance analysis from the last 2 weeks</p>
                        
                        {recentHistory.length === 0 ? (
                            <div className="bg-gray-100 rounded-lg p-8 border text-center">
                                <p className="text-gray-600">No prediction data yet. Check back after predictions are made!</p>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-5 border-2 border-green-300">
                                        <h2 className="text-xl font-bold text-green-800 mb-4 flex items-center gap-2">
                                            <Star fill={true} />
                                            Top 5 Biggest Wins
                                        </h2>
                                        {topWins.length === 0 ? (
                                            <p className="text-sm text-green-700">No profitable predictions yet</p>
                                        ) : (
                                            <div className="space-y-3">
                                                {topWins.map((pred, idx) => (
                                                    <div key={idx} className="bg-white rounded-lg p-3 border border-green-200">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="font-bold text-gray-800">{pred.ticker}</span>
                                                            <span className="text-green-600 font-bold text-lg">+${pred.profit.toFixed(2)}</span>
                                                        </div>
                                                        <div className="text-xs text-gray-600">
                                                            <span>Predicted: {pred.predictedMove}</span> • <span>Actual: {pred.actualMove}</span>
                                                        </div>
                                                        <div className="text-xs text-gray-500 mt-1">{formatDate(pred.predictionDate)} • Confidence: {pred.confidence}%</div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-5 border-2 border-red-300">
                                        <h2 className="text-xl font-bold text-red-800 mb-4 flex items-center gap-2">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                            </svg>
                                            Top 5 Biggest Losses
                                        </h2>
                                        {topLosses.length === 0 ? (
                                            <p className="text-sm text-red-700">No losses yet - perfect streak!</p>
                                        ) : (
                                            <div className="space-y-3">
                                                {topLosses.map((pred, idx) => (
                                                    <div key={idx} className="bg-white rounded-lg p-3 border border-red-200">
                                                        <div className="flex justify-between items-center mb-1">
                                                            <span className="font-bold text-gray-800">{pred.ticker}</span>
                                                            <span className="text-red-600 font-bold text-lg">${pred.profit.toFixed(2)}</span>
                                                        </div>
                                                        <div className="text-xs text-gray-600">
                                                            <span>Predicted: {pred.predictedMove}</span> • <span>Actual: {pred.actualMove}</span>
                                                        </div>
                                                        <div className="text-xs text-gray-500 mt-1">{formatDate(pred.predictionDate)} • Confidence: {pred.confidence}%</div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                </div>
                                
                                <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-5 border-2 border-blue-300">
                                    <h2 className="text-xl font-bold text-blue-800 mb-4 flex items-center gap-2">
                                        <Clock />
                                        Performance by Time
                                    </h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div className="bg-white rounded-lg p-4 border border-blue-200">
                                            <h3 className="font-semibold text-gray-800 mb-3">Best Day of the Week</h3>
                                            <div className="space-y-2">
                                                {['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'].map(day => {
                                                    const stats = dayStats[day];
                                                    if (!stats || stats.total === 0) return null;
                                                    const accuracy = ((stats.correct / stats.total) * 100).toFixed(0);
                                                    return (
                                                        <div key={day} className="flex justify-between items-center">
                                                            <span className="text-sm text-gray-700">{day}</span>
                                                            <div className="flex items-center gap-2">
                                                                <div className="w-32 bg-gray-200 rounded-full h-2">
                                                                    <div 
                                                                        className={`h-2 rounded-full ${accuracy >= 70 ? 'bg-green-500' : accuracy >= 50 ? 'bg-yellow-500' : 'bg-red-500'}`}
                                                                        style={{ width: `${accuracy}%` }}
                                                                    ></div>
                                                                </div>
                                                                <span className="text-sm font-bold text-gray-600 w-10">{accuracy}%</span>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                        
                                        <div className="bg-white rounded-lg p-4 border border-blue-200">
                                            <h3 className="font-semibold text-gray-800 mb-3">Last 4 Weeks Accuracy</h3>
                                            <div className="space-y-2">
                                                {weeklyStats.filter(w => w.total > 0).map((week, idx) => (
                                                    <div key={idx} className="flex justify-between items-center">
                                                        <span className="text-sm text-gray-700">{week.label}</span>
                                                        <span className={`text-sm font-bold ${week.accuracy >= 70 ? 'text-green-600' : 'text-gray-600'}`}>
                                                            {week.accuracy}%
                                                        </span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                                        <div className="bg-white rounded-lg p-3 border border-blue-200 text-center">
                                            <div className="text-xs text-gray-600 mb-1">Total Predictions</div>
                                            <div className="text-2xl font-bold text-blue-600">{recentHistory.length}</div>
                                            <div className="text-xs text-gray-500">Last 2 weeks</div>
                                        </div>
                                        <div className="bg-white rounded-lg p-3 border border-blue-200 text-center">
                                            <div className="text-xs text-gray-600 mb-1">Win Rate</div>
                                            <div className="text-2xl font-bold text-green-600">
                                                {((recentHistory.filter(p => p.wasCorrect).length / recentHistory.length) * 100).toFixed(0)}%
                                            </div>
                                            <div className="text-xs text-gray-500">Overall</div>
                                        </div>
                                        <div className="bg-white rounded-lg p-3 border border-blue-200 text-center">
                                            <div className="text-xs text-gray-600 mb-1">Avg Profit</div>
                                            <div className={`text-2xl font-bold ${predictionsWithProfit.reduce((sum, p) => sum + p.profit, 0) / predictionsWithProfit.length >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                ${(predictionsWithProfit.reduce((sum, p) => sum + p.profit, 0) / predictionsWithProfit.length).toFixed(2)}
                                            </div>
                                            <div className="text-xs text-gray-500">Per prediction</div>
                                        </div>
                                        <div className="bg-white rounded-lg p-3 border border-blue-200 text-center">
                                            <div className="text-xs text-gray-600 mb-1">Total P/L</div>
                                            <div className={`text-2xl font-bold ${predictionsWithProfit.reduce((sum, p) => sum + p.profit, 0) >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                ${predictionsWithProfit.reduce((sum, p) => sum + p.profit, 0).toFixed(2)}
                                            </div>
                                            <div className="text-xs text-gray-500">All predictions</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg" style={{paddingBottom: 'env(safe-area-inset-bottom)'}}>
                        <div className="flex justify-around max-w-lg mx-auto px-4 py-4">
                            <button onClick={() => setCurrentPage('main')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Home /><span className="text-xs">Home</span></button>
                            <button onClick={() => setCurrentPage('predictions')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Clock /><span className="text-xs">Predictions</span></button>
                            <button onClick={() => setCurrentPage('insights')} className="flex flex-col items-center gap-1 text-pink-500" style={{marginTop: '-2px'}}><Lightbulb /><span className="text-xs">Insights</span></button>
                            <button onClick={() => setCurrentPage('coffee')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Coffee /><span className="text-xs">Coffee</span></button>
                        </div>
                    </div>
                </div>
                );
            }
            
            // Coffee Page
            return (
                <div className="min-h-screen bg-white p-4 pb-24" style={{paddingTop: 'calc(1rem + env(safe-area-inset-top))'}}>
                    <div className="max-w-md w-full mx-auto">
                        {!showFeedbackForm ? (
                            <div className="flex flex-col items-center justify-center min-h-[70vh] text-center px-4">
                                <div className="w-48 h-48 mx-auto mb-8 text-pink-500 flex items-center justify-center">
                                    <svg width="192" height="192" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                        <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                                        <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                                        <line x1="6" y1="1" x2="6" y2="4"></line>
                                        <line x1="10" y1="1" x2="10" y2="4"></line>
                                        <line x1="14" y1="1" x2="14" y2="4"></line>
                                    </svg>
                                </div>
                                <p className="text-xl mb-8">Tipping culture is out of control; however, this app is free - so if I've made you some money, buy me a coffee.</p>
                                <button onClick={() => {
                                    const venmoUrl = 'venmo://paycharge?txn=pay&recipients=adrian-hutchins';
                                    const venmoWebUrl = 'https://venmo.com/u/adrian-hutchins';
                                    
                                    window.location.href = venmoUrl;
                                    
                                    setTimeout(() => {
                                        window.open(venmoWebUrl, '_blank');
                                    }, 1000);
                                }} className="w-full bg-gradient-to-br from-pink-100 to-pink-200 py-4 rounded-lg font-semibold">Buy Her a Coffee</button>
                                <p className="text-xs text-gray-500 mt-4">Venmo: @adrian-hutchins</p>
                                
                                <button 
                                    onClick={() => setShowFeedbackForm(true)}
                                    className="mt-8 w-full bg-gradient-to-br from-purple-100 to-purple-200 py-4 rounded-lg font-semibold flex items-center justify-center gap-2"
                                >
                                    <MessageSquare />
                                    Send Feedback
                                </button>
                            </div>
                        ) : (
                            <div className="px-4 py-8">
                                <button 
                                    onClick={() => setShowFeedbackForm(false)}
                                    className="mb-4 flex items-center gap-2 text-gray-600 hover:text-gray-800"
                                >
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                                    </svg>
                                    Back
                                </button>
                                
                                <h1 className="text-3xl font-bold mb-6 text-center">We'd Love Your Input</h1>
                                
                                <div className="bg-gradient-to-br from-pink-50 to-pink-100 rounded-lg p-6 border">
                                    <div className="mb-6">
                                        <label className="block font-semibold mb-3">Suggestions or Feedback</label>
                                        <textarea 
                                            value={feedback} 
                                            onChange={(e) => setFeedback(e.target.value)} 
                                            placeholder="Share your thoughts..." 
                                            className="w-full h-32 px-4 py-3 border rounded-lg resize-none bg-white"
                                        />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-3">Email Address</label>
                                        <input 
                                            type="email" 
                                            value={email} 
                                            onChange={(e) => setEmail(e.target.value)} 
                                            placeholder="your.email@example.com" 
                                            className="w-full px-4 py-3 border rounded-lg bg-white"
                                        />
                                        {email && !isValidEmail(email) && (
                                            <p className="text-red-600 text-xs mt-2">Please enter a valid email</p>
                                        )}
                                    </div>
                                </div>
                                
                                <button 
                                    disabled={!isFormValid} 
                                    onClick={() => { 
                                        const formId = '1FAIpQLSdPV46GRekasxpBYwYsMkX4YWKmjTwpBEUl0lRPrav8KCORVA';
                                        const emailEntryId = '1360878470';
                                        const feedbackEntryId = '1214908827';
                                        
                                        const encodedEmail = encodeURIComponent(email);
                                        const encodedFeedback = encodeURIComponent(feedback);
                                        
                                        const submitUrl = `https://docs.google.com/forms/d/e/${formId}/formResponse?entry.${emailEntryId}=${encodedEmail}&entry.${feedbackEntryId}=${encodedFeedback}&submit=Submit`;
                                        
                                        const iframe = document.createElement('iframe');
                                        iframe.style.display = 'none';
                                        iframe.name = 'hidden_iframe';
                                        document.body.appendChild(iframe);
                                        
                                        const form = document.createElement('form');
                                        form.method = 'POST';
                                        form.action = `https://docs.google.com/forms/d/e/${formId}/formResponse`;
                                        form.target = 'hidden_iframe';
                                        
                                        const input1 = document.createElement('input');
                                        input1.type = 'hidden';
                                        input1.name = `entry.${emailEntryId}`;
                                        input1.value = email;
                                        form.appendChild(input1);
                                        
                                        const input2 = document.createElement('input');
                                        input2.type = 'hidden';
                                        input2.name = `entry.${feedbackEntryId}`;
                                        input2.value = feedback;
                                        form.appendChild(input2);
                                        
                                        document.body.appendChild(form);
                                        form.submit();
                                        
                                        setTimeout(() => {
                                            document.body.removeChild(form);
                                            document.body.removeChild(iframe);
                                        }, 1000);
                                        
                                        alert('Feedback sent! Thank you! 💖');
                                        setFeedback('');
                                        setEmail('');
                                        setShowFeedbackForm(false);
                                    }} 
                                    className={`w-full mt-6 py-4 rounded-lg font-semibold ${isFormValid ? 'bg-gradient-to-br from-pink-100 to-pink-200' : 'bg-gray-200 text-gray-400'}`}
                                >
                                    Let Her Know
                                </button>
                                <p className="text-xs text-gray-400 italic text-center mt-4">Your email information will be shared.</p>
                            </div>
                        )}
                    </div>
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg" style={{paddingBottom: 'env(safe-area-inset-bottom)'}}>
                        <div className="flex justify-around max-w-lg mx-auto px-4 py-4">
                            <button onClick={() => setCurrentPage('main')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Home /><span className="text-xs">Home</span></button>
                            <button onClick={() => setCurrentPage('predictions')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Clock /><span className="text-xs">Predictions</span></button>
                            <button onClick={() => setCurrentPage('insights')} className="flex flex-col items-center gap-1 text-gray-400" style={{marginTop: '-2px'}}><Lightbulb /><span className="text-xs">Insights</span></button>
                            <button onClick={() => setCurrentPage('coffee')} className="flex flex-col items-center gap-1 text-pink-500" style={{marginTop: '-2px'}}><Coffee /><span className="text-xs">Coffee</span></button>
                        </div>
                    </div>
                </div>
            );
        }

        // Main App Wrapper with Popup
        function App() {
            const [popup, setPopup] = useState(null);

            useEffect(() => {
                fetch('https://adrianhutchins.pythonanywhere.com/static/Announcements.json')
                    .then(res => {
                        if (!res.ok) {
                            console.error('Failed to fetch announcements:', res.status);
                            return null;
                        }
                        return res.json();
                    })
                    .then(data => {
                        if (data && data.enabled) {
                            const lastVersion = localStorage.getItem('popupVersion');
                            if (!data.showOnce || lastVersion !== data.version) {
                                setPopup(data);
                            }
                        }
                    })
                    .catch(err => {
                        console.error('Error fetching announcements:', err);
                    });
            }, []);

            const closePopup = () => {
                if (popup) {
                    if (popup.showOnce) {
                        localStorage.setItem('popupVersion', popup.version);
                    }
                    setPopup(null);
                }
            };

            return (
                <>
                    <DartApp />
                    
                    {popup && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={closePopup}>
                            <div className="bg-pink-200 rounded-2xl p-6 max-w-md w-full shadow-2xl" onClick={(e) => e.stopPropagation()}>
                                <div className="bg-white rounded-xl p-6">
                                    {popup.imageUrl && (
                                        <div className="flex justify-center mb-4">
                                            {popup.imageUrl.endsWith('.lottie') || popup.imageUrl.endsWith('.json') ? (
                                                <lottie-player
                                                    src={popup.imageUrl}
                                                    background="transparent"
                                                    speed="1"
                                                    style={{width: '128px', height: '128px'}}
                                                    loop
                                                    autoplay
                                                ></lottie-player>
                                            ) : popup.imageUrl.endsWith('.webm') || popup.imageUrl.endsWith('.mp4') ? (
                                                <video 
                                                    src={popup.imageUrl} 
                                                    autoPlay 
                                                    loop 
                                                    muted 
                                                    playsInline
                                                    className="w-32 h-32 object-contain"
                                                />
                                            ) : (
                                                <img 
                                                    src={popup.imageUrl} 
                                                    alt="Announcement" 
                                                    className="w-32 h-32 object-contain"
                                                />
                                            )}
                                        </div>
                                    )}
                                    
                                    <h2 className="text-2xl font-bold mb-3 text-gray-900 text-center">{popup.title}</h2>
                                    <p className="text-gray-700 mb-6 leading-relaxed text-center">{popup.message}</p>
                                    <button 
                                        onClick={closePopup}
                                        className="w-full bg-gradient-to-br from-pink-400 to-pink-500 text-white py-3 rounded-lg font-semibold hover:from-pink-500 hover:to-pink-600 transition-all"
                                    >
                                        {popup.buttonText || 'Got it!'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
